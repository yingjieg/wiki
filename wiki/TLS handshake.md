# TLS handshake

## When does a TLS handshake occur?

TLS handshakes occur after a TCP connection has been opened via a TCP handshake.

## What happens during a TLS handshake?

During the course of a TLS handshake, the client and server together will do the following:

* Specify which version of TLS (TLS 1.0, 1.2, 1.3, etc.) they will use.
* Decide on which cipher suites (see below) they will use.
* Authenticate the identity of the server via the server's private key and the SSL certificate authority's digital signature.
* Generate session keys in order to use symmetric encryption after the handshake in complete.

What are the steps of a TLS handshake?

> TLS handshakes are a series of datagrams, or messages, exchanged by a client and a server. A TLS handshake involves multiple steps, as the client and server exchange the information necessary for completing the handshake and making further conversation possible.

__The exact steps within a TLS handshake will vary depending upon the kind of key exchange algorithm used and the cipher suites supported by both sides. The RSA key exchange algorithm is used most often. It goes as follows:__

1. __The 'client hello' message:__ The client initiates the handshake by sending a "hello" message to the server. The message will include which TLS version the client supports, the cipher suites supported, and a string of random bytes known as the "client random".
1. __The 'server hello' message:__ in reply to the client hello message, the server sends a message containing the server's SSL certificate, the server's chosen cipher suite, and the "server random", another random string of bytes that's generated by the server.
1. __Authentication:__ Then client verifies the server's SSL certifcate with the certificate authority that issued it.
1. __The premaster secret:__ The client sends one more random string of bytes, the "premaster secret". The premaster secret is encrypted with the public key and can only be decrypted with the private key by the server. (The client gets the public key from the server' SSL certificate.)
1. __Private key used:__ The server decrypts the premaster secret.
1. __Session keys created:__ Both client and server generate session keys from the client random, the server random, and the premaster secret. They should arrive at the same results.
1. __Client is ready__: The client sends a "finished" message that is encrypted with a session key.
1. __Server is ready__: The server sends a "finished" message encrypted with a session key.
1. __Secure symmetric encryption achieved:__ The handshake is completed, and communication continues using the session keys. 